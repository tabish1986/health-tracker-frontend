<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords"
        content="wrappixel, admin dashboard, html css dashboard, web dashboard, bootstrap 5 admin, bootstrap 5, css3 dashboard, bootstrap 5 dashboard, Ample lite admin bootstrap 5 dashboard, frontend, responsive bootstrap 5 admin template, Ample admin lite dashboard bootstrap 5 dashboard template">
    <meta name="description"
        content="Ample Admin Lite is powerful and clean admin dashboard template, inpired from Bootstrap Framework">
    <meta name="robots" content="noindex,nofollow">
    <title>Health Watch</title>
    <link rel="canonical" href="https://www.wrappixel.com/templates/ample-admin-lite/" />   
    <link rel="icon" type="image/png" sizes="16x16" href="plugins/images/favicon.png">
    <link href="css/style.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>   
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>   
    <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
        data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">  

        <header class="topbar" data-navbarbg="skin5" style="height: 0px;">
            <nav class="navbar top-navbar navbar-expand-md navbar-dark">
                <div class="navbar-header" data-logobg="skin6">                   
                    <a class="navbar-brand" href="profile.html">                        
                        <b class="logo-icon">
                            <!-- Dark Logo icon -->
                            <img src="plugins/images/logo-icon.png" alt="homepage" />
                        </b>                        
                        <span class="logo-text">                           
                            <img src="plugins/images/logo-text.png" alt="homepage" />
                        </span>
                    </a>                   
                    <a class="nav-toggler waves-effect waves-light text-dark d-block d-md-none"
                        href="javascript:void(0)"><i class="ti-menu ti-close"></i></a>
                </div>                
            </nav>
        </header>
        
        <aside class="left-sidebar" data-sidebarbg="skin6">            
            <div class="scroll-sidebar">               
                <nav class="sidebar-nav">
                    <ul id="sidebarnav">
                        <li class="sidebar-item pt-2" style="margin-bottom: 5px;">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link">
                                <i class="fas fa-user-circle" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: cornflowerblue; font-size:medium; color: rgb(40, 206, 128); " id="userTitle">Welcome, User</span>
                            </a>
                        </li>                       
                        <li class="sidebar-item pt-2">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="summary-dashboard.html"
                                aria-expanded="false">
                                <i class="fas fa-th-large" aria-hidden="true"></i>
                                <span class="hide-menu" style="color:black; font-size:medium; ">Summary Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="bloodpressure-dashboard.html"
                                aria-expanded="false">
                                <i class=" fas fa-tv" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium; ">BP Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="glucose-dashboard.html"
                                aria-expanded="false">
                                <i class=" fas fa-tv" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium; ">Glucose Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="pulse-dashboard.html"
                                aria-expanded="false">
                                <i class=" fas fa-tv" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium; ">Pulse Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="respiration-dashboard.html"  
                                aria-expanded="false">
                                <i class=" fas fa-tv" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium; ">Respiration Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item" style="background-color: rgba(179, 213, 243, 0.846);">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="profile.html"
                                aria-expanded="false">
                                <i class="fas fa-user" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium; font-weight: bold;">Profile</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link" href="changePassword.html"
                                aria-expanded="false">
                                <i class="fas fa-edit" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium;">Change Password</span>
                            </a>
                        </li>
                        <li class="sidebar-item" data-toggle='modal' data-target='#myModal' type="button">
                            <a class="sidebar-link waves-effect waves-dark sidebar-link"
                                aria-expanded="false">
                                <i class="fas fa-lock" aria-hidden="true"></i>
                                <span class="hide-menu" style="color: black; font-size: medium;">Logout</span>
                            </a>
                        </li>                                                            
                    </ul>

                </nav>                
            </div>            
        </aside>
       
        <div class="page-wrapper">

            <div class="page-breadcrumb" style="background-color: rgba(191, 218, 241, 0.572);">
                <div class="row align-items-center">
                    <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                        <h4 class="page-title">Update Profile</h4>
                    </div>                    
                </div>                
            </div>

            <div class="container-fluid">
                    <div>
                        <div class="modal-content">
                            <div class="alert alert-primary">            
                                <h4 class="modal-title">User Details</h4>
                              </div>
                            <div class="modal-body">
                                <form id="formContent" class="needs-validation1" novalidate>
                                    <div class="mb-2" style="text-align: center;">
                                        <label style="text-align: center; background-color:#dbe7f0; color: rgb(0, 110, 174); font-size:small; font-weight:600; display: none;" id="profileError">Unable to save profile</label>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                          <label for="inputName">Name</label>
                                          <input type="text" class="form-control" id="inputName" maxlength="20" onkeypress="return /[0-9a-zA-Z \-_]/i.test(event.key)" required>
                                        </div>
                                        <div class="form-group col-md-6">
                                          <label for="inputEmail">Email address</label>  
                                          <input type="text" class="form-control" id="inputEmail" maxlength="30" onkeypress="return /[0-9a-zA-Z \-_.@]/i.test(event.key)">
                                        </div>
                                    </div> 
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                          <label for="inputMobNo">Mobile Number</label>
                                          <input type="text" class="form-control" id="inputMobNo" maxlength="20" onkeypress="return /[0-9]/i.test(event.key)" required>
                                        </div>                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success" data-dismiss="modal" id="saveProfile">Save</button>                                
                                    </div>
                                  </form>
                            </div>                            
                        </div>

                        <div class="modal-content" style="margin-top: 30px;">
                            <div class="alert alert-primary">            
                                <h4 class="modal-title">Health Basics</h4>
                            </div>
                            <div class="modal-body">
                                <form id="formContent" class="needs-validation2" novalidate>
                                    <div class="mb-2" style="text-align: center;">
                                        <label style="text-align: center; background-color:#dbe7f0; color: rgb(0, 110, 174); font-size:small; font-weight:600; display: none;" id="basicsError">Unable to save basics</label>
                                    </div>                                    
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                          <label for="inputSystolic">Gender</label>
                                          <input type="text" class="form-control" id="inputGender" maxlength="6" onkeypress="return /[a-zA-Z]/i.test(event.key)" required>
                                        </div>
                                        <div class="form-group col-md-6">
                                          <label for="inputDiastolic">Age</label>  
                                          <input type="text" class="form-control" id="inputAge" maxlength="5" onkeypress="return /[0-9a-zA-Z \-_]/i.test(event.key)" required>
                                        </div>
                                    </div> 
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                          <label for="inputSystolic">Height</label>
                                          <input type="text" class="form-control" id="inputHeight" maxlength="10" onkeypress="return /[0-9a-zA-Z \-_]/i.test(event.key)">
                                        </div>  
                                        <div class="form-group col-md-6">
                                            <label for="inputSystolic">Weight</label>
                                            <input type="text" class="form-control" id="inputWeight" maxlength="10" onkeypress="return /[0-9a-zA-Z \-_]/i.test(event.key)">
                                          </div>                                       
                                    </div>  
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                          <label for="inputSystolic">Diagnosed Diseases</label>
                                          <input type="text" class="form-control" id="inputDiseases" maxlength="70" onkeypress="return /[0-9a-zA-Z \-,]/i.test(event.key)">
                                        </div>                                                                              
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success" data-dismiss="modal" id="saveBasics">Save</button>                                
                                    </div>
                                  </form>
                            </div>                            
                        </div> 
                    </div>
            </div>      
        </div>      
    </div>
   
    <script src="assets/custom/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>    
    <script src="js/custom.js"></script>    
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="js/logout.js"></script>
    <script>

        $(document).ready(function() {
            loadUserTitle();
            loadProfileAndBasics();
            validationHandler();
        });

        function validationHandler()
        {
            'use strict';
            window.addEventListener('submit', function(event) {
            
            var forms;

            if (event.submitter.id == 'saveProfile')                        
                forms = document.getElementsByClassName('needs-validation1');
            else if (event.submitter.id == 'saveBasics')
                forms = document.getElementsByClassName('needs-validation2');

            //var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
            
                if (form.checkValidity() === false) {     
                    event.preventDefault();
                    event.stopPropagation();
                }
                else
                {   
                    event.preventDefault();                        

                    if (event.submitter.id == 'saveProfile')                        
                        saveProfileAndBasics('1');
                    else if (event.submitter.id == 'saveBasics')
                        saveProfileAndBasics('2');
                }
                form.classList.add('was-validated');                    
            });
            }, false);
        }
        
        var session_userId = window.sessionStorage.getItem("session_userid");
        var session_token = "Bearer " + window.sessionStorage.getItem("seession_token");

        function loadUserTitle()
        {
            $('#userTitle').text("Welcome, " + window.sessionStorage.getItem("seession_name"));
        }

        function loadProfileAndBasics()
        {
            $.ajax({
                    type:"GET",
                    beforeSend: function(request){
                        request.setRequestHeader("Authorization",session_token);
                    },
                    url:"http://localhost:8081/api/v1/users/" + session_userId + "/profilebasics",
                    data: '{}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    crossDomain: false,
                    success: function(response){
                        $('#inputName').val(response[0].FIRST_NAME);
                        $('#inputEmail').val(response[0].EMAIL_ADDRESS);
                        $('#inputMobNo').val(response[0].MOBILE_NO);

                        $('#inputGender').val(response[0].GENDER);
                        $('#inputAge').val(response[0].AGE);
                        $('#inputHeight').val(response[0].HEIGHT);
                        $('#inputWeight').val(response[0].WEIGHT);
                        $('#inputDiseases').val(response[0].KNOWNDISEASES);
                    },
                    error: function (response){
                        alert('Technical Error: Unable to update profile');
                    }
                });
        }
        function saveProfileAndBasics(saveCategory)
        {
            var profName = $('#inputName').val();
            var profEmail = $('#inputEmail').val();
            var profMobNo = $('#inputMobNo').val();
            var basicsGender = $('#inputGender').val();
            var basicsAge = $('#inputAge').val();
            var basicsHeight = $('#inputHeight').val();
            var basicsWeight = $('#inputWeight').val();
            var basicsDisease = $('#inputDiseases').val();               

            data = {
                Category    : saveCategory,
                Name        : profName,
                Email       : profEmail,
                MobNo       : profMobNo,
                Gender      : basicsGender,
                Age         : basicsAge,
                Height      : basicsHeight,
                Weight      : basicsWeight,
                Disease     : basicsDisease
            }

            $.ajax({
                    type:"POST",
                    beforeSend: function(request){
                        request.setRequestHeader("Authorization",session_token);
                    },
                    url:"http://localhost:8081/api/v1/users/" + session_userId + "/profilebasics",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    crossDomain: false,
                    success: function(response){
                        if (saveCategory == '1')
                        {
                            $('#profileError').text('Profile updated successfully'); 
                            $('#profileError').show();
                        }                   
                        else
                        {
                            $('#basicsError').text('Basics updated successfully'); 
                            $('#basicsError').show();                                
                        }             
                    },
                    error: function (response){
                        if (response.status==200)
                        {
                            if (saveCategory == '1')
                            {
                                $('#profileError').text('Profile updated successfully'); 
                                $('#profileError').show();
                            }                   
                            else
                            {
                                $('#basicsError').text('Basics updated successfully'); 
                                $('#basicsError').show();                                
                            }  
                        }
                        else
                            alert('Technical Error: Unable to save changes');
                    }
                });
        }
</script>

<div class="container">      
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header alert-danger">
            
            <h4 class="modal-title">Confirmation</h4>
          </div>
          <div class="modal-body ">
            <p>Are you sure you want to Logout ?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" data-dismiss="modal" onclick="terminateSession()">Yes</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
  </div>
    
</body>

</html>